{% extends "base.html" %}
{% block title %}Carrinho | Fichas de Malharia{% endblock %}
{% block content %}

<style>
  /* Ajustes locais (cores/organiza√ß√£o) */
  .cart-list{ margin-top:12px; display:flex; flex-direction:column; gap:10px; }
  .cart-item{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding:12px;
    border:1px solid #eee;
    border-radius:14px;
    background:#fff;
  }
  .cart-item .title{ font-weight:800; color:#111; }
  .cart-item .price{ font-weight:900; color:#111; white-space:nowrap; }
  .cart-item .left{ display:flex; flex-direction:column; gap:4px; min-width:0; }
  .cart-item .right{ display:flex; align-items:center; gap:10px; flex-shrink:0; }

  .total-row{
    margin-top:14px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding-top:12px;
    border-top:1px solid #f0f0f0;
    font-size:16px;
  }
  .total-row strong{ font-size:18px; }

  .checkout-grid{
    display:grid;
    grid-template-columns:1fr auto;
    gap:10px;
    align-items:end;
    margin-top:12px;
  }
  @media (max-width:700px){
    .checkout-grid{ grid-template-columns:1fr; }
  }

  /* Inputs com borda suave */
  input[type="email"], input[name="email"]{
    width:100%;
    height:44px;
    padding:10px 12px;
    border:1px solid #ccc;
    border-radius:12px;
    background:#fff;
    color:#111;
  }

  /* ‚úÖ Bot√µes menores no carrinho */
  .btn-sm{
    padding: 6px 12px;
    font-size: 13px;
    line-height: 1.1;
    border-radius: 9999px;
  }

  /* ‚úÖ Destaque maior nos itens do carrinho */
  .cart-item{
    border: 1px solid rgba(0,0,0,.06);
    border-left: 4px solid var(--line-olive);
    background: #fff;
    border-radius: 16px;
    padding: 16px 16px;
    box-shadow: 0 6px 18px rgba(0,0,0,.05);
    transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
  }

  .cart-item + .cart-item{
    margin-top: 12px;
  }

  .cart-item:hover{
    transform: translateY(-1px);
    box-shadow: 0 10px 24px rgba(0,0,0,.08);
    border-color: var(--line-olive);
  }

  /* (opcional) deixa o t√≠tulo ainda mais ‚Äúproduto‚Äù */
  .cart-item .title{
    font-weight: 800;
  }
</style>

<div class="page-head">
  <div>
    <h1>Carrinho</h1>
    <p class="sub">Revise seus itens e finalize o pagamento com checkout seguro.</p>
  </div>
</div>

{% if fichas|length == 0 %}

  <div class="card" style="margin-top:14px;">
    <h2>Seu carrinho est√° vazio.</h2>
    <p class="muted" style="margin-top:6px;">Volte para a busca e adicione as fichas que precisa.</p>
    <div style="margin-top:12px;">
      <a class="btn btn-primary" href="{{ url_for('busca') }}">Voltar ao cat√°logo</a>      
    </div>
  </div>

{% else %}

  <div class="card" style="margin-top:14px;">
    <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:12px;">
      <div>
        <h2>Itens no carrinho</h2>
        <p class="muted" style="margin-top:6px;">Voc√™ pode remover itens antes de finalizar.</p>
      </div>
  
      <a href="{{ url_for('home') }}" class="btn btn-sm" style="white-space:nowrap;">
        Continuar comprando
      </a>
    </div>
  
    <div class="cart-list">
      {% for f in fichas %}
        <div class="cart-item">
          <div class="left">
            <div class="title">{{ f.titulo }}</div>
            <div class="muted">Pre√ßo unit√°rio</div>
          </div>
  
          <div class="right">
            <div class="price">R$ {{ "%.2f"|format(f.preco) }}</div>
          
            <div style="display:flex; flex-direction:column; gap:8px; align-items:flex-end;">
              <a href="{{ url_for('ficha_detalhe', ficha_id=f.id) }}"
                 class="btn ghost btn-sm"
                 style="white-space:nowrap;">
                Detalhes
              </a>
            
              <form method="post" action="/cart/remove/{{ f.id }}" style="margin:0;">
                <button class="btn ghost btn-sm" type="submit" style="white-space:nowrap;">
                  Remover
                </button>
              </form>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <div class="total-row">
      <div><b>Total</b></div>
      <div><strong>R$ {{ "%.2f"|format(total) }}</strong></div>
    </div>
  </div>

  <div class="card" style="margin-top:14px;">
    <h2>Finalizar</h2>
    <p class="muted" style="margin-top:6px;">Informe seu e-mail para receber o link de acesso ap√≥s o pagamento.</p>

    <form method="post" action="/checkout" class="checkout-grid">
      <label style="display:block;">
        <div style="font-weight:700; margin-bottom:6px;">Seu e-mail</div>
        <input type="email" name="email" placeholder="ex: seuemail@dominio.com" required>
      </label>

      <button class="btn" type="submit">Pagar com Mercado Pago</button>
    </form>

    <div class="muted" style="margin-top:10px; font-size:13px;">
      üîí Pagamento processado via Mercado Pago ‚Ä¢ ‚ö° Entrega por link no e-mail
    </div>
  </div>

{% endif %}

{% endblock %}
