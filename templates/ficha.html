{% extends "base.html" %}
{% block title %}{{ ficha.titulo }} | Fichas de Malharia{% endblock %}
{% block content %}

<style>
  /* Card principal */
  .card.product{
    background:#fff;
    border:1px solid #eee;
  }

  /* Cabeçalho do produto */
  .product-head{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:14px;
    flex-wrap:wrap;
  }
  .product-title{ margin:0; }
  .product-buy{
    display:flex;
    flex-direction:column;
    align-items:flex-end;
    gap:10px;
    min-width:220px;
  }
  @media (max-width:820px){
    .product-buy{ align-items:flex-start; width:100%; }
  }

  /* Preço destacado */
  .product-price{
    font-weight:900;
    font-size:22px;
    color:#111;
    padding:8px 12px;
    border-radius:9999px;
    background: var(--olive-50);
    border:1px solid var(--line-olive);
    width:fit-content;
  }

  /* Grid de cards */
  .product-grid{
    margin-top:14px;
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:14px;
  }
  @media (max-width:900px){
    .product-grid{ grid-template-columns:1fr; }
  }

  /* Cards internos sempre brancos */
  .product .card{
    background:#fff !important;
    border:1px solid #eee;
  }

  /* Meta (informações) */
  .meta{
    display:flex;
    flex-direction:column;
    gap:8px;
    margin-top:10px;
    color:#333;
    font-size:14px;
  }
  .meta span b{ color:#111; }

  /* Lista */
  .list{
    margin:10px 0 0 18px;
  }
  .list li{ margin:6px 0; }

  /* Bloco “Prévia” com espaçamento consistente */
  .product .card h2{ margin-top:0; }
</style>

<div class="card product">
  <div class="product-head">
    <div>
      <h1 class="product-title">{{ ficha.titulo }}</h1>
      <p class="muted">
        Tipo: <b>{{ ficha.tipo_malha }}</b> • Categoria: <b>{{ ficha.categoria }}</b>
      </p>
    </div>

    <div class="product-buy">
      <div class="product-price">R$ {{ "%.2f"|format(ficha.preco) }}</div>

      {% if in_cart %}
        <a class="btn" href="/cart">Ir para o carrinho</a>
      {% else %}
        <form method="post" action="/cart/add/{{ ficha.id }}" style="margin:0;">
          <button class="btn" type="submit">Adicionar ao carrinho</button>
        </form>
      {% endif %}
    </div>
  </div>

  <div class="product-grid">
    <div class="card">
      <h2>Especificações</h2>
      <div class="meta">
        <span><b>Composição:</b> {{ ficha.composicao }}</span>
        <span><b>Gramatura:</b> {{ ficha.gramatura }} g/m²</span>
        <span><b>Largura:</b> {{ "%.2f"|format(ficha.largura) if ficha.largura else "-" }} m</span>
      </div>
    </div>

    <div class="card">
      <h2>O que você recebe</h2>
      <ul class="list">
        <li>Ficha técnica em PDF com especificações e parâmetros do artigo</li>
        <li>Campos comerciais e recomendações de uso</li>
        <li>Checklist de qualidade e observações críticas</li>
      </ul>
      <p class="muted" style="margin-top:10px;">Entrega por link após pagamento.</p>
    </div>
  </div>

  <div class="card" style="margin-top:14px;">
    <h2>Prévia</h2>
    {% if preview_url %}
      <p class="muted">Prévia rápida do conteúdo (arquivo separado de preview).</p>
      <a class="btn ghost" href="{{ preview_url }}" target="_blank" rel="noopener">Abrir prévia (PDF)</a>
    {% else %}
      <p class="muted">
        Prévia não disponível para esta ficha no momento.
        (Se você enviar um arquivo de preview para o storage com o sufixo <b>_preview.pdf</b>, ela aparece automaticamente.)
      </p>
    {% endif %}
  </div>
</div>

{% endblock %}
