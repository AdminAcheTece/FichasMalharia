{% extends "base.html" %}
{% block title %}{{ ficha.titulo }} | Fichas de Malharia{% endblock %}
{% block content %}

<style>
  /* Card principal */
  .card.product{
    background:#fff;
    border:1px solid #eee;
  }

  /* Cabe√ßalho do produto */
  .product-head{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:14px;
    flex-wrap:wrap;
  }
  .product-title{ margin:0; }
  .product-buy{
    display:flex;
    flex-direction:column;
    align-items:flex-end;
    gap:10px;
    min-width:220px;
  }
  @media (max-width:820px){
    .product-buy{ align-items:flex-start; width:100%; }
  }

  /* Pre√ßo destacado */
  .product-price{
    font-weight:900;
    font-size:22px;
    color:#111;
    padding:8px 12px;
    border-radius:9999px;
    background: var(--olive-50);
    border:1px solid var(--line-olive);
    width:fit-content;
  }

  /* Grid de cards */
  .product-grid{
    margin-top:14px;
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:14px;
  }
  @media (max-width:900px){
    .product-grid{ grid-template-columns:1fr; }
  }

  /* Cards internos sempre brancos */
  .product .card{
    background:#fff !important;
    border:1px solid #eee;
  }

  /* Meta (informa√ß√µes) */
  .meta{
    display:flex;
    flex-direction:column;
    gap:8px;
    margin-top:10px;
    color:#333;
    font-size:14px;
  }
  .meta span b{ color:#111; }

  /* Lista */
  .list{
    margin:10px 0 0 18px;
  }
  .list li{ margin:6px 0; }

  /* Bloco ‚ÄúPr√©via‚Äù com espa√ßamento consistente */
  .product .card h2{ margin-top:0; }
</style>

<!-- ‚úÖ Link r√°pido para voltar ao carrinho -->
<a href="{{ url_for('cart_view') }}" class="muted" style="display:inline-block; margin-bottom:10px;">
  ‚Üê Voltar ao carrinho
</a>

<div class="card product">
  <div class="product-head">
    <div>
      <h1 class="product-title">{{ ficha.titulo }}</h1>
      <p class="muted">
        Tipo: <b>{{ ficha.tipo_malha }}</b> ‚Ä¢ Categoria: <b>{{ ficha.categoria }}</b>
      </p>
    </div>

    <div class="product-buy">
      <div class="product-price">R$ {{ "%.2f"|format(ficha.preco) }}</div>

      <!-- ‚úÖ A√ß√µes principais + bot√£o de voltar ao carrinho sempre vis√≠vel -->
      <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;">
        {% if in_cart %}
          <a class="btn" href="{{ url_for('cart_view') }}">Ir para o carrinho</a>
        {% else %}
          <form method="post" action="/cart/add/{{ ficha.id }}" style="margin:0;">
            <button class="btn" type="submit">Adicionar ao carrinho</button>
          </form>
        {% endif %}

        <a class="btn ghost" href="{{ url_for('cart_view') }}">üõí Voltar ao carrinho</a>
      </div>
    </div>
  </div>

  <div class="product-grid">
    <div class="card">
      <h2>Especifica√ß√µes</h2>
      <div class="meta">
        <span><b>Composi√ß√£o:</b> {{ ficha.composicao }}</span>
        <span><b>Gramatura:</b> {{ ficha.gramatura }} g/m¬≤</span>
        <span><b>Largura:</b> {{ "%.2f"|format(ficha.largura) if ficha.largura else "-" }} m</span>
      </div>
    </div>

    <div class="card">
      <h2>O que voc√™ recebe</h2>
      <ul class="list">
        <li>Ficha t√©cnica em PDF com especifica√ß√µes e par√¢metros do artigo</li>
        <li>Campos comerciais e recomenda√ß√µes de uso</li>
        <li>Checklist de qualidade e observa√ß√µes cr√≠ticas</li>
      </ul>
      <p class="muted" style="margin-top:10px;">Entrega por link ap√≥s pagamento.</p>
    </div>
  </div>

  <div class="card" style="margin-top:14px;">
    <h2>Pr√©via</h2>
    {% if preview_url %}
      <p class="muted">Pr√©via r√°pida do conte√∫do (arquivo separado de preview).</p>
      <a class="btn ghost" href="{{ preview_url }}" target="_blank" rel="noopener">Abrir pr√©via (PDF)</a>
    {% else %}
      <p class="muted">
        Pr√©via n√£o dispon√≠vel para esta ficha no momento.
        (Se voc√™ enviar um arquivo de preview para o storage com o sufixo <b>_preview.pdf</b>, ela aparece automaticamente.)
      </p>
    {% endif %}
  </div>
</div>

{% endblock %}
