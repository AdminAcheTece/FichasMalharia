{% extends "base.html" %}
{% block title %}Busca | Fichas de Malharia{% endblock %}
{% block content %}

<!-- ✅ pequenos overrides locais (cores) -->
<style>
  /* Link "Ver detalhes" seguindo a paleta */
  .link{
    color: var(--olive) !important;
    font-weight:700;
    text-decoration:none;
    white-space:nowrap;
  }
  .link:hover{
    color: var(--olive-600) !important;
    text-decoration:underline;
    text-underline-offset:3px;
  }

  /* Cards de resultado com leitura melhor */
  .card.ficha{
    border:1px solid #eee;
    background:#fff;
  }

  /* Meta */
  .meta{
    display:flex;
    flex-wrap:wrap;
    gap:8px 12px;
    margin-top:6px;
    color:#333;
    font-size:14px;
  }
  .meta span b{ color:#111; }

  .price{ font-weight:900; color:#111; }

  .actions{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin-top:12px;
    padding-top:12px;
    border-top:1px solid #f0f0f0;
  }
  .actions-right{
    display:flex;
    align-items:center;
    gap:10px;
    flex-wrap:wrap;
    justify-content:flex-end;
  }

  /* ✅ NOVO: botões do filtro lado a lado */
  .filter-actions{
    grid-column: 1 / -1;
    display:flex;
    gap:12px;
    justify-content:flex-start; /* se quiser à direita, troque por flex-end */
    align-items:center;
    margin-top:4px;
  }
  .filter-actions .btn{
    min-width: 180px;         /* deixa parecido com o seu “Limpar” atual */
    justify-content:center;
  }
  @media (max-width:700px){
    .filter-actions{
      flex-direction:column;  /* no celular fica um embaixo do outro */
      align-items:stretch;
    }
    .filter-actions .btn{ min-width: 0; width:100%; }
  }
</style>

<div class="page-head">
  <div>
    <h1>Catálogo de Fichas Técnicas de Malharia</h1>
    <p class="sub">Use os filtros para encontrar a ficha certa e adicione ao carrinho.</p>
  </div>
</div>

<div class="card" style="margin-top:14px;">
  <form class="grid" method="get">
    <label>
      Tipo de malha
      <select name="tipo">
        <option value="">Todos</option>
        {% for t in tipos %}
          <option value="{{ t }}" {% if filtros.tipo == t %}selected{% endif %}>{{ t }}</option>
        {% endfor %}
      </select>
    </label>

    <label>
      Categoria
      <select name="categoria">
        <option value="">Todas</option>
        {% for c in categorias %}
          <option value="{{ c }}" {% if filtros.categoria == c %}selected{% endif %}>{{ c }}</option>
        {% endfor %}
      </select>
    </label>

    <label>
      Composição (contém)
      <input name="composicao" value="{{ filtros.composicao or '' }}" placeholder="Ex: elastano">
    </label>

    <label>
      Gramatura mín.
      <input type="number" name="gramatura_min" value="{{ filtros.gramatura_min or '' }}">
    </label>

    <label>
      Gramatura máx.
      <input type="number" name="gramatura_max" value="{{ filtros.gramatura_max or '' }}">
    </label>

    <!-- ✅ AQUI: os dois botões na mesma linha (linha do “Limpar”) -->
    <div class="filter-actions">
      <a class="btn ghost" href="/busca">Limpar</a>
      <button class="btn" type="submit">Filtrar</button>
    </div>
  </form>
</div>

<div class="results">
  {% if fichas|length == 0 %}
    <p style="margin-top:12px;">Nenhuma ficha encontrada com esses filtros.</p>
  {% else %}
    {% for f in fichas %}
      <div class="card ficha">
        <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:12px;">
          <div>
            <h3>{{ f.titulo }}</h3>
            <div class="meta">
              <span><b>Tipo:</b> {{ f.tipo_malha }}</span>
              <span><b>Comp:</b> {{ f.composicao }}</span>
              <span><b>Gram:</b> {{ f.gramatura }} g/m²</span>
              <span><b>Larg:</b> {{ "%.2f"|format(f.largura) }} m</span>
              <span><b>Categoria:</b> {{ f.categoria }}</span>
            </div>
          </div>

          <a class="link" href="/ficha/{{ f.id }}">Ver detalhes</a>
        </div>

        <div class="actions">
          <div class="price">R$ {{ "%.2f"|format(f.preco) }}</div>

          <div class="actions-right">
            {% set no_carrinho = (cart_ids is defined and f.id in cart_ids) %}

            {% if no_carrinho %}
              <span class="btn ghost" style="pointer-events:none; opacity:.9;">✅ No carrinho</span>

              <form method="post" action="/cart/remove/{{ f.id }}" style="margin:0;">
                <button class="btn ghost" type="submit">Remover</button>
              </form>
            {% else %}
              <form method="post" action="/cart/add/{{ f.id }}" style="margin:0;">
                <button class="btn" type="submit">Adicionar ao carrinho</button>
              </form>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  {% endif %}
</div>

{% endblock %}
