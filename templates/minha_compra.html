{% extends "base.html" %}
{% block title %}Minha compra | Fichas de Malharia{% endblock %}
{% block content %}

<style>
  .card.legal{
    background:#fff;
    border:1px solid #eee;
  }

  /* KPIs */
  .purchase-kpis{
    margin-top:14px;
    display:grid;
    grid-template-columns:repeat(3, minmax(0, 1fr));
    gap:12px;
  }
  @media (max-width:900px){
    .purchase-kpis{ grid-template-columns:1fr; }
  }
  .kpi{
    background: var(--olive-50);
    border:1px solid var(--line-olive);
    border-radius:14px;
    padding:12px;
  }
  .kpi-label{
    font-size:12px;
    color:#555;
    font-weight:800;
    text-transform:uppercase;
    letter-spacing:.3px;
  }
  .kpi-value{
    margin-top:6px;
    font-size:16px;
    font-weight:900;
    color:#111;
    word-break:break-word;
  }

  /* Lista */
  .purchase-list{
    margin-top:10px;
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .purchase-item{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding:12px;
    border:1px solid #eee;
    border-radius:14px;
    background:#fff;
  }
  @media (max-width:820px){
    .purchase-item{ flex-direction:column; align-items:stretch; }
  }

  .purchase-main{ min-width:0; }
  .purchase-title{
    font-weight:900;
    color:#111;
  }
  .purchase-meta{
    margin-top:4px;
    color:#444;
    font-weight:700;
    font-size:14px;
  }

  .purchase-actions{
    display:flex;
    align-items:center;
    justify-content:flex-end;
    gap:10px;
    flex-wrap:wrap;
  }
  @media (max-width:820px){
    .purchase-actions{ justify-content:flex-start; }
  }

  .divider{
    border:0;
    border-top:1px solid #eee;
    margin:18px 0;
  }

  /* “Baixar” como CTA forte */
  .purchase-actions .btn{
    white-space:nowrap;
  }
</style>

<div class="card legal">
  <h1>Minha compra</h1>
  <p class="muted">
    Pedido <b>#{{ pedido_id }}</b> • {{ pedido_data }} • {{ email_mask }}<br>
    Acesso válido até <b>{{ expira_em }}</b>.
  </p>

  <div class="purchase-kpis">
    <div class="kpi">
      <div class="kpi-label">Total</div>
      <div class="kpi-value">{{ total }}</div>
    </div>
    <div class="kpi">
      <div class="kpi-label">Entrega</div>
      <div class="kpi-value">Links de download</div>
    </div>
    <div class="kpi">
      <div class="kpi-label">Suporte</div>
      <div class="kpi-value">{{ support_email }}</div>
    </div>
  </div>

  <h2 style="margin-top:16px;">Seus itens</h2>

  <div class="purchase-list">
    {% for it in itens %}
      <div class="purchase-item">
        <div class="purchase-main">
          <div class="purchase-title">{{ it.titulo }}</div>
          <div class="purchase-meta">{{ it.preco }}</div>
        </div>

        <div class="purchase-actions">
          {% if it.details_link %}
            <a class="btn ghost" href="{{ it.details_link }}">Ver detalhes</a>
          {% endif %}

          {% if it.download_link %}
            <a class="btn" href="{{ it.download_link }}">Baixar</a>
          {% else %}
            <span class="muted">Arquivo indisponível</span>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>

  <hr class="divider">

  <p class="muted">
    Dica: se o download não iniciar, tente novamente ou use outro navegador. Se persistir, fale com o suporte.
  </p>
</div>

{% endblock %}
